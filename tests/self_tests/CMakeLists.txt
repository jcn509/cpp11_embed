include("${CMAKE_CURRENT_LIST_DIR}/../../cmake_integration/Cpp11Embed.cmake")

set(TEST_FILES_DIR "${CMAKE_CURRENT_LIST_DIR}/../test_files")
set(AUTO_GENERATED_HEADERS_DIR "${CMAKE_CURRENT_BINARY_DIR}/AutoGenerated")
cpp11_embed_generate_header(
    "${TEST_FILES_DIR}/two_lines.txt"
    "k_text_header"
    "${AUTO_GENERATED_HEADERS_DIR}/TextHeader.h"
)

cpp11_embed_generate_header(
    "${TEST_FILES_DIR}/two_lines.txt"
    "k_text_header_with_header_guard"
    "${AUTO_GENERATED_HEADERS_DIR}/TextHeaderWithHeaderGuard.h"
    USE_HEADER_GUARD TRUE
)

cpp11_embed_generate_header(
    "${TEST_FILES_DIR}/two_lines.txt"
    "k_binary_header"
    "${AUTO_GENERATED_HEADERS_DIR}/BinaryHeader.h"
    BINARY_MODE TRUE
)

cpp11_embed_generate_header(
    "${TEST_FILES_DIR}/two_lines.txt"
    "k_binary_header_with_header_guard"
    "${AUTO_GENERATED_HEADERS_DIR}/BinaryHeaderWithHeaderGuard.h"
    BINARY_MODE TRUE
    USE_HEADER_GUARD TRUE
)

add_executable(Cpp11EmbedSelfTests
    Main.cpp
    SelfTests.cpp
    "${AUTO_GENERATED_HEADERS_DIR}/TextHeader.h"
    "${AUTO_GENERATED_HEADERS_DIR}/TextHeaderWithHeaderGuard.h"
    "${AUTO_GENERATED_HEADERS_DIR}/BinaryHeader.h"
    "${AUTO_GENERATED_HEADERS_DIR}/BinaryHeaderWithHeaderGuard.h"
)

target_link_libraries(Cpp11EmbedSelfTests PRIVATE
    Cpp11EmbedLib
    Catch2::Catch2
)

target_include_directories(Cpp11EmbedSelfTests PRIVATE "${AUTO_GENERATED_HEADERS_DIR}")

catch_discover_tests(
    Cpp11EmbedSelfTests
    TEST_PREFIX "Self Test: "
)
